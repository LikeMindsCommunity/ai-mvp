<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter Integration Assistant - API Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #1565c0;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: #1565c0;
            color: white;
            border-color: #1565c0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
        }

        .control-panel {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-right: 20px;
            margin-bottom: 20px;
        }

        .output-panel {
            flex: 2;
            min-width: 450px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            padding: 8px 16px;
            margin: 5px 5px 5px 0;
            background-color: #1565c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0d47a1;
        }

        button:disabled {
            background-color: #b0bec5;
            cursor: not-allowed;
        }

        .response-log {
            height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .response {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
        }

        .error {
            background-color: #f8d7da;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
        }

        .token-display {
            font-size: 12px;
            word-break: break-all;
            background-color: #f0f0f0;
            padding: 5px;
            border-radius: 4px;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <h1>Flutter Integration Assistant - API Tester</h1>

    <div class="tabs">
        <div class="tab active" data-tab="auth">Authentication</div>
        <div class="tab" data-tab="profile">User Profile</div>
        <div class="tab" data-tab="projects">Projects</div>
        <div class="tab" data-tab="websocket">WebSocket</div>
    </div>

    <div id="auth" class="tab-content active">
        <div class="container">
            <div class="control-panel">
                <h2>Authentication Tests</h2>

                <div class="form-group">
                    <label for="authBaseUrl">API Base URL:</label>
                    <input type="text" id="authBaseUrl" value="http://localhost:8000">
                </div>

                <h3>Register</h3>
                <div class="form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password:</label>
                    <input type="password" id="registerPassword" placeholder="Min 8 characters">
                </div>
                <div class="form-group">
                    <label for="registerFullName">Full Name:</label>
                    <input type="text" id="registerFullName" placeholder="John Doe">
                </div>
                <button id="registerBtn">Register</button>

                <h3>Login</h3>
                <div class="form-group">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password:</label>
                    <input type="password" id="loginPassword" placeholder="Password">
                </div>
                <button id="loginBtn">Login</button>

                <h3>Logout</h3>
                <button id="logoutBtn">Logout</button>

                <div class="form-group">
                    <label>Current Token:</label>
                    <div id="currentToken" class="token-display">No token</div>
                </div>
            </div>

            <div class="output-panel">
                <h3>Response</h3>
                <div id="authResponseLog" class="response-log"></div>
                <button id="clearAuthLogBtn">Clear Log</button>
            </div>
        </div>
    </div>

    <div id="profile" class="tab-content">
        <div class="container">
            <div class="control-panel">
                <h2>User Profile Tests</h2>

                <div class="form-group">
                    <label for="profileBaseUrl">API Base URL:</label>
                    <input type="text" id="profileBaseUrl" value="http://localhost:8000">
                </div>

                <h3>Get Profile</h3>
                <button id="getProfileBtn">Get My Profile</button>

                <h3>Update Profile</h3>
                <div class="form-group">
                    <label for="updateFullName">Full Name:</label>
                    <input type="text" id="updateFullName" placeholder="New Name">
                </div>
                <div class="form-group">
                    <label for="updateAvatarUrl">Avatar URL:</label>
                    <input type="text" id="updateAvatarUrl" placeholder="https://example.com/avatar.jpg">
                </div>
                <div class="form-group">
                    <label for="updatePreferences">Preferences (JSON):</label>
                    <textarea id="updatePreferences" placeholder='{"theme": "dark", "notifications": true}'></textarea>
                </div>
                <button id="updateProfileBtn">Update Profile</button>
            </div>

            <div class="output-panel">
                <h3>Response</h3>
                <div id="profileResponseLog" class="response-log"></div>
                <button id="clearProfileLogBtn">Clear Log</button>
            </div>
        </div>
    </div>

    <div id="projects" class="tab-content">
        <div class="container">
            <div class="control-panel">
                <h2>Projects Tests</h2>

                <div class="form-group">
                    <label for="projectsBaseUrl">API Base URL:</label>
                    <input type="text" id="projectsBaseUrl" value="http://localhost:8000">
                </div>

                <h3>Create Project</h3>
                <div class="form-group">
                    <label for="projectName">Project Name:</label>
                    <input type="text" id="projectName" placeholder="My Flutter Project">
                </div>
                <div class="form-group">
                    <label for="projectDescription">Project Description:</label>
                    <textarea id="projectDescription"
                        placeholder="A Flutter project for testing LikeMinds integration"></textarea>
                </div>
                <button id="createProjectBtn">Create Project</button>

                <h3>Get Projects</h3>
                <button id="getProjectsBtn">Get All Projects</button>

                <h3>Get Project</h3>
                <div class="form-group">
                    <label for="getProjectId">Project ID:</label>
                    <input type="text" id="getProjectId" placeholder="Project UUID">
                </div>
                <button id="getProjectBtn">Get Project</button>

                <h3>Update Project</h3>
                <div class="form-group">
                    <label for="updateProjectId">Project ID:</label>
                    <input type="text" id="updateProjectId" placeholder="Project UUID">
                </div>
                <div class="form-group">
                    <label for="updateProjectName">Name:</label>
                    <input type="text" id="updateProjectName" placeholder="Updated Project Name">
                </div>
                <div class="form-group">
                    <label for="updateProjectDescription">Description:</label>
                    <textarea id="updateProjectDescription" placeholder="Updated project description"></textarea>
                </div>
                <div class="form-group">
                    <label for="updateProjectSettings">Settings (JSON):</label>
                    <textarea id="updateProjectSettings"
                        placeholder='{"language": "dart", "flutter_version": "3.10.0"}'></textarea>
                </div>
                <button id="updateProjectBtn">Update Project</button>

                <h3>Delete Project</h3>
                <div class="form-group">
                    <label for="deleteProjectId">Project ID:</label>
                    <input type="text" id="deleteProjectId" placeholder="Project UUID">
                </div>
                <button id="deleteProjectBtn">Delete Project</button>

                <h3>Share Project</h3>
                <div class="form-group">
                    <label for="shareProjectId">Project ID:</label>
                    <input type="text" id="shareProjectId" placeholder="Project UUID">
                </div>
                <div class="form-group">
                    <label for="shareUserEmail">User Email:</label>
                    <input type="email" id="shareUserEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label for="shareRole">Role:</label>
                    <select id="shareRole">
                        <option value="viewer">Viewer</option>
                        <option value="editor">Editor</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button id="shareProjectBtn">Share Project</button>
            </div>

            <div class="output-panel">
                <h3>Response</h3>
                <div id="projectsResponseLog" class="response-log"></div>
                <button id="clearProjectsLogBtn">Clear Log</button>
            </div>
        </div>
    </div>

    <div id="websocket" class="tab-content">
        <div class="container">
            <div class="control-panel">
                <h2>WebSocket Tests</h2>

                <div class="form-group">
                    <label for="wsBaseUrl">WebSocket URL:</label>
                    <input type="text" id="wsBaseUrl" value="ws://localhost:8000/api/flutter">
                </div>

                <div class="form-group">
                    <label for="wsToken">JWT Token:</label>
                    <input type="text" id="wsToken" placeholder="JWT Token from login">
                    <button id="useStoredTokenBtn">Use Stored Token</button>
                </div>

                <div class="form-group">
                    <label for="wsProjectId">Project ID:</label>
                    <input type="text" id="wsProjectId" placeholder="Project UUID">
                </div>

                <h3>Connection</h3>
                <div id="wsStatus"
                    style="padding: 8px; margin-bottom: 10px; border-radius: 4px; background-color: #f8d7da;">
                    Disconnected
                </div>
                <button id="wsConnectBtn">Connect</button>
                <button id="wsDisconnectBtn" disabled>Disconnect</button>

                <h3>Send Message</h3>
                <div class="form-group">
                    <label for="wsRequestType">Request Type:</label>
                    <select id="wsRequestType">
                        <option value="GenerateCode">Generate Code</option>
                        <option value="GenerateConversation">Generate Conversation</option>
                        <option value="FixCode">Fix Code</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="wsUserQuery">Query:</label>
                    <textarea id="wsUserQuery" placeholder="Create a Flutter chat screen with LikeMinds SDK"></textarea>
                </div>

                <div id="wsErrorMessageContainer" style="display: none;">
                    <div class="form-group">
                        <label for="wsErrorMessage">Error Message:</label>
                        <textarea id="wsErrorMessage" placeholder="Flutter analysis error message"></textarea>
                    </div>
                </div>

                <button id="wsSendBtn" disabled>Send Request</button>
            </div>

            <div class="output-panel">
                <h3>Messages</h3>
                <div id="wsResponseLog" class="response-log"></div>
                <button id="clearWsLogBtn">Clear Log</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        const state = {
            accessToken: localStorage.getItem('accessToken') || null,
            wsConnection: null
        };

        // Update token display
        function updateTokenDisplay() {
            const tokenEl = document.getElementById('currentToken');
            if (state.accessToken) {
                tokenEl.textContent = state.accessToken.substring(0, 20) + '...';
            } else {
                tokenEl.textContent = 'No token';
            }
        }

        // Initialize token display
        updateTokenDisplay();

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Helper functions
        function appendResponse(containerId, response, isSuccess = true) {
            const logContainer = document.getElementById(containerId);
            const responseDiv = document.createElement('div');
            responseDiv.className = `response ${isSuccess ? 'success' : 'error'}`;

            // Create timestamp
            const timestamp = document.createElement('div');
            timestamp.style.fontWeight = 'bold';
            timestamp.textContent = new Date().toLocaleTimeString();
            responseDiv.appendChild(timestamp);

            // Add response content
            const pre = document.createElement('pre');
            if (typeof response === 'object') {
                pre.textContent = JSON.stringify(response, null, 2);
            } else {
                pre.textContent = response;
            }
            responseDiv.appendChild(pre);

            logContainer.appendChild(responseDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        async function apiRequest(url, method, body = null, token = null) {
            const headers = {
                'Content-Type': 'application/json'
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const options = {
                method,
                headers,
                credentials: 'include'
            };

            if (body && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(url, options);
                const contentType = response.headers.get('content-type');

                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    return { success: response.ok, data, status: response.status };
                } else {
                    const text = await response.text();
                    return { success: response.ok, data: text, status: response.status };
                }
            } catch (error) {
                return { success: false, data: error.message, status: 0 };
            }
        }

        // Auth tab
        document.getElementById('registerBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('authBaseUrl').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const fullName = document.getElementById('registerFullName').value;

            if (!email || !password || !fullName) {
                appendResponse('authResponseLog', 'Please fill all fields', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/auth/register`,
                'POST',
                { email, password, full_name: fullName }
            );

            appendResponse('authResponseLog', response, response.success);

            if (response.success && response.data.access_token) {
                state.accessToken = response.data.access_token;
                localStorage.setItem('accessToken', state.accessToken);
                updateTokenDisplay();
            }
        });

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('authBaseUrl').value;
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                appendResponse('authResponseLog', 'Please fill all fields', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/auth/login`,
                'POST',
                { email, password }
            );

            appendResponse('authResponseLog', response, response.success);

            if (response.success && response.data.access_token) {
                state.accessToken = response.data.access_token;
                localStorage.setItem('accessToken', state.accessToken);
                updateTokenDisplay();
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('authBaseUrl').value;

            if (!state.accessToken) {
                appendResponse('authResponseLog', 'Not logged in', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/auth/logout`,
                'POST',
                null,
                state.accessToken
            );

            appendResponse('authResponseLog', response, response.success);

            // Clear token regardless of response
            state.accessToken = null;
            localStorage.removeItem('accessToken');
            updateTokenDisplay();
        });

        document.getElementById('clearAuthLogBtn').addEventListener('click', () => {
            document.getElementById('authResponseLog').innerHTML = '';
        });

        // Profile tab
        document.getElementById('getProfileBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('profileBaseUrl').value;

            if (!state.accessToken) {
                appendResponse('profileResponseLog', 'Not logged in', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/users/me`,
                'GET',
                null,
                state.accessToken
            );

            appendResponse('profileResponseLog', response, response.success);
        });

        document.getElementById('updateProfileBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('profileBaseUrl').value;
            const fullName = document.getElementById('updateFullName').value;
            const avatarUrl = document.getElementById('updateAvatarUrl').value;
            const preferencesStr = document.getElementById('updatePreferences').value;

            if (!state.accessToken) {
                appendResponse('profileResponseLog', 'Not logged in', false);
                return;
            }

            const updateData = {};
            if (fullName) updateData.full_name = fullName;
            if (avatarUrl) updateData.avatar_url = avatarUrl;

            if (preferencesStr) {
                try {
                    updateData.preferences = JSON.parse(preferencesStr);
                } catch (e) {
                    appendResponse('profileResponseLog', 'Invalid JSON in preferences', false);
                    return;
                }
            }

            if (Object.keys(updateData).length === 0) {
                appendResponse('profileResponseLog', 'No data to update', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/users/me`,
                'PUT',
                updateData,
                state.accessToken
            );

            appendResponse('profileResponseLog', response, response.success);
        });

        document.getElementById('clearProfileLogBtn').addEventListener('click', () => {
            document.getElementById('profileResponseLog').innerHTML = '';
        });

        // Projects tab
        document.getElementById('createProjectBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            if (!name) {
                appendResponse('projectsResponseLog', 'Project name is required', false);
                return;
            }

            const projectData = { name };
            if (description) projectData.description = description;

            const response = await apiRequest(
                `${baseUrl}/api/projects/`,
                'POST',
                projectData,
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('getProjectsBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/projects/`,
                'GET',
                null,
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('getProjectBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;
            const projectId = document.getElementById('getProjectId').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            if (!projectId) {
                appendResponse('projectsResponseLog', 'Project ID is required', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/projects/${projectId}`,
                'GET',
                null,
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('updateProjectBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;
            const projectId = document.getElementById('updateProjectId').value;
            const name = document.getElementById('updateProjectName').value;
            const description = document.getElementById('updateProjectDescription').value;
            const settingsStr = document.getElementById('updateProjectSettings').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            if (!projectId) {
                appendResponse('projectsResponseLog', 'Project ID is required', false);
                return;
            }

            const updateData = {};
            if (name) updateData.name = name;
            if (description) updateData.description = description;

            if (settingsStr) {
                try {
                    updateData.settings = JSON.parse(settingsStr);
                } catch (e) {
                    appendResponse('projectsResponseLog', 'Invalid JSON in settings', false);
                    return;
                }
            }

            if (Object.keys(updateData).length === 0) {
                appendResponse('projectsResponseLog', 'No data to update', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/projects/${projectId}`,
                'PUT',
                updateData,
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('deleteProjectBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;
            const projectId = document.getElementById('deleteProjectId').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            if (!projectId) {
                appendResponse('projectsResponseLog', 'Project ID is required', false);
                return;
            }

            if (!confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/projects/${projectId}`,
                'DELETE',
                null,
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('shareProjectBtn').addEventListener('click', async () => {
            const baseUrl = document.getElementById('projectsBaseUrl').value;
            const projectId = document.getElementById('shareProjectId').value;
            const userEmail = document.getElementById('shareUserEmail').value;
            const role = document.getElementById('shareRole').value;

            if (!state.accessToken) {
                appendResponse('projectsResponseLog', 'Not logged in', false);
                return;
            }

            if (!projectId || !userEmail) {
                appendResponse('projectsResponseLog', 'Project ID and user email are required', false);
                return;
            }

            const response = await apiRequest(
                `${baseUrl}/api/projects/${projectId}/share`,
                'POST',
                { user_email: userEmail, role },
                state.accessToken
            );

            appendResponse('projectsResponseLog', response, response.success);
        });

        document.getElementById('clearProjectsLogBtn').addEventListener('click', () => {
            document.getElementById('projectsResponseLog').innerHTML = '';
        });

        // WebSocket tab
        document.getElementById('wsRequestType').addEventListener('change', () => {
            const requestType = document.getElementById('wsRequestType').value;
            const errorContainer = document.getElementById('wsErrorMessageContainer');

            if (requestType === 'FixCode') {
                errorContainer.style.display = 'block';
            } else {
                errorContainer.style.display = 'none';
            }
        });

        document.getElementById('useStoredTokenBtn').addEventListener('click', () => {
            if (state.accessToken) {
                document.getElementById('wsToken').value = state.accessToken;
            } else {
                appendResponse('wsResponseLog', 'No token stored', false);
            }
        });

        document.getElementById('wsConnectBtn').addEventListener('click', () => {
            if (state.wsConnection) {
                appendResponse('wsResponseLog', 'Already connected', false);
                return;
            }

            const baseUrl = document.getElementById('wsBaseUrl').value;
            const token = document.getElementById('wsToken').value;
            const projectId = document.getElementById('wsProjectId').value;

            if (!token || !projectId) {
                appendResponse('wsResponseLog', 'Token and Project ID are required', false);
                return;
            }

            // Build WebSocket URL with query parameters
            const wsUrl = `${baseUrl}?token=${encodeURIComponent(token)}&project_id=${encodeURIComponent(projectId)}`;

            try {
                state.wsConnection = new WebSocket(wsUrl);

                state.wsConnection.onopen = () => {
                    document.getElementById('wsStatus').textContent = 'Connected';
                    document.getElementById('wsStatus').style.backgroundColor = '#d4edda';
                    document.getElementById('wsConnectBtn').disabled = true;
                    document.getElementById('wsDisconnectBtn').disabled = false;
                    document.getElementById('wsSendBtn').disabled = false;
                    appendResponse('wsResponseLog', 'WebSocket connection established');
                };

                state.wsConnection.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        let isSuccess = true;

                        if (data.type === 'Error') {
                            isSuccess = false;
                        }

                        appendResponse('wsResponseLog', data, isSuccess);
                    } catch (e) {
                        appendResponse('wsResponseLog', `Error parsing message: ${event.data}`, false);
                    }
                };

                state.wsConnection.onclose = () => {
                    document.getElementById('wsStatus').textContent = 'Disconnected';
                    document.getElementById('wsStatus').style.backgroundColor = '#f8d7da';
                    document.getElementById('wsConnectBtn').disabled = false;
                    document.getElementById('wsDisconnectBtn').disabled = true;
                    document.getElementById('wsSendBtn').disabled = true;
                    state.wsConnection = null;
                    appendResponse('wsResponseLog', 'WebSocket connection closed');
                };

                state.wsConnection.onerror = (error) => {
                    appendResponse('wsResponseLog', `WebSocket error: ${error}`, false);
                };
            } catch (e) {
                appendResponse('wsResponseLog', `Failed to connect: ${e.message}`, false);
            }
        });

        document.getElementById('wsDisconnectBtn').addEventListener('click', () => {
            if (state.wsConnection) {
                state.wsConnection.close();
            }
        });

        document.getElementById('wsSendBtn').addEventListener('click', () => {
            if (!state.wsConnection) {
                appendResponse('wsResponseLog', 'Not connected', false);
                return;
            }

            const requestType = document.getElementById('wsRequestType').value;
            const userQuery = document.getElementById('wsUserQuery').value;

            if (!userQuery) {
                appendResponse('wsResponseLog', 'Query is required', false);
                return;
            }

            const message = {
                type: requestType,
                user_query: userQuery
            };

            if (requestType === 'FixCode') {
                const errorMessage = document.getElementById('wsErrorMessage').value;
                if (!errorMessage) {
                    appendResponse('wsResponseLog', 'Error message is required for FixCode', false);
                    return;
                }
                message.error_message = errorMessage;
            }

            state.wsConnection.send(JSON.stringify(message));
            appendResponse('wsResponseLog', `Sent: ${JSON.stringify(message)}`);
        });

        document.getElementById('clearWsLogBtn').addEventListener('click', () => {
            document.getElementById('wsResponseLog').innerHTML = '';
        });
    </script>
</body>

</html>