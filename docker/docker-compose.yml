version: '3.8'

services:
  flutter-assistant:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "8000:8000"  # API port
      - "8080:8080"  # Web server port for Flutter previews
    volumes:
      - ../integration:/app/integration  # Mount integration directory
      - ../output:/app/output  # Mount output directory
    env_file:
      - .env
    environment:
      # API Configuration
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GEMINI_MODEL=${GEMINI_MODEL}
      
      # Server Configuration
      - WEB_HOST=${WEB_HOST}
      - WEB_PORT=${WEB_PORT}
      - FLUTTER_WEB_PORT=${FLUTTER_WEB_PORT}
      - COMMAND_TIMEOUT=${COMMAND_TIMEOUT}
      - BUILD_TIMEOUT=${BUILD_TIMEOUT}
      - PUBLIC_HOST=${PUBLIC_HOST}
      
      # Frontend Configuration
      - FRONTEND_URL=${FRONTEND_URL}
      - FRONTEND_CALLBACK_PATH=${FRONTEND_CALLBACK_PATH}
      
      # Supabase Configuration
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      
      # GitHub OAuth Configuration
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - GITHUB_CALLBACK_URL=${GITHUB_CALLBACK_URL}
      
      # Security Configuration
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - JWT_ALGORITHM=${JWT_ALGORITHM}
      - ACCESS_TOKEN_EXPIRE_MINUTES=${ACCESS_TOKEN_EXPIRE_MINUTES}
      - REFRESH_TOKEN_EXPIRE_DAYS=${REFRESH_TOKEN_EXPIRE_DAYS}
      
      # CORS Configuration
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    restart: unless-stopped 