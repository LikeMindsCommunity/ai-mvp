version: '3.8'

services:
  flutter-assistant:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "8000:8000"  # API port
      - "8080:8080"  # Web server port for Flutter previews
    volumes:
      - ../integration:/app/integration  # Mount integration directory
      - ../output:/app/output  # Mount output directory
    env_file:
      - .env
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GEMINI_MODEL=${GEMINI_MODEL}
      - WEB_HOST=${WEB_HOST}  # Bind to all interfaces
      - PUBLIC_HOST=${PUBLIC_HOST}  # Public IP for URLs returned to clients
      - FLUTTER_WEB_PORT=${FLUTTER_WEB_PORT}
      - WEB_PORT=${WEB_PORT}
      - COMMAND_TIMEOUT=${COMMAND_TIMEOUT}
      - BUILD_TIMEOUT=${BUILD_TIMEOUT}
    restart: unless-stopped 